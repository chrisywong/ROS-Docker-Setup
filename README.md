# ROS-Docker-Setup
Repository containing Dockerfile for ROS Humble with packages for Kinova Gen3 and MoveIt

- Crash course on Docker: https://www.youtube.com/watch?v=_dfLOzuIg2o
- Slightly more in-depth: https://www.youtube.com/watch?v=rIrNIzy6U_g
- Even more in-depth: https://www.youtube.com/playlist?list=PLunhqkrRNRhaqt0UfFxxC_oj7jscss2qe

# Table of Contents
- [Installation Guide](#installation-guide)
- [Launching and Controlling Kinova Gen3](#launching-and-controlling-kinova-gen3)
- [Writing your own scripts and packages](#writing-your-own-scripts-and-packages)
 <!--TOC generated by https://ecotrust-canada.github.io/markdown-toc/ -->

# Installation Guide
1. Install Docker https://docs.docker.com/engine/install/ubuntu/
	* Optional step: https://docs.docker.com/engine/install/linux-postinstall/
2. Pull ROS Humble Docker image `sudo docker pull osrf/ros:humble-desktop-full`
3. Install Rocker using `sudo apt-get install -y python3-rocker`
	* Reference: https://github.com/osrf/rocker
 	* If installation fails, follow "Setup Sources" here: https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debs.html
  	* Then run `sudo apt update && apt install -y python3-rocker`
4. Test Rocker using `sudo rocker --x11 --user --volume=$HOME:$HOME osrf/ros:humble-desktop-full`
5. [OPTIONAL] If running computer with NVIDIA, install NVIDIA Container Toolkit https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html
    * Go through the `Installing with Apt` and `Configuring Docker` sections
6. Download the `Dockerfile` from this repository and navigate to folder containing `Dockerfile`
    * If you are working in WSL, getting files back and forth isn't fun, so it'll be easier to just create the file yourself:
    1. In terminal, navigate where you want to put this file (e.g., `cd ~ && mkdir docker && cd docker`. This go to your home folder `~`, create a `docker` folder, and navigate into the `docker` folder)
    2. Create a new file using `vim Dockerfile` (if you have `vim` installed, it automatically opens the file in `vim`)
      * If you don't have `vim` installed, install it using `sudo apt install vim`
      * `vim` is a command line-based text editor that does NOT work like regular word processor. There are shortcuts you need to learn in order to even just edit/copy/paste.
    3. Copy and paste the code from https://github.com/LAIR-Lab/ROS-Docker-Setup/blob/main/Dockerfile into the terminal
    4. Save the file by pressing `Esc`, then `:wq` + `enter` (`Esc` puts it into command mode, `:wq` means "command, write to file, quit")
7. In terminal, build the docker image using `sudo docker build -t lairlab-ros-docker:humble-kinova .`
8. Run `rocker` using newly built image: 
	* `sudo rocker --x11 --user --volume=$HOME:$HOME lairlab-ros-docker:humble-kinova`
    * Note: You can add `--nvidia` flag if you are using a computer with an NVIDIA card (unknown if it actually makes a difference)
    * Note: This will most likely start you out in the `root` folder `/`. Make sure you navigate into the `home` folder before starting anything.
    	* Important Note: Files created in Docker are generally not persistent and get deleted when the Docker shuts down, so make sure that you are working out of a persistent folder! (which is the `home` folder if you use the above command)
9. Done!

# Launching and Controlling Kinova Gen3 
https://github.com/Kinovarobotics/ros2_kortex

Note 1: You need two separate terminals and both need to have the Docker image loaded.

Note 2: ROS nodes running inside a Docker container can be seen by `ros2 topic list` outside of the container.

Note 3: The robot model we currently have in the lab is the **6 dof** with **no** vision module (the default is the 7 dof model). So beware when loading robot models/configurations

0. Launch `rocker` container from above
1. Launch Ignition simulation
  * `ros2 launch kortex_bringup kortex_sim_control.launch.py use_sim_time:=true launch_rviz:=false dof:=6`
2. Launch MoveIt (with Ignition simulation)
  * `ros2 launch kinova_gen3_6dof_robotiq_2f_85_moveit_config sim.launch.py use_sim_time:=true`
  * Note: You need to change the `Planning Group` to `manipulator`. Also change `velocity scaling` and `acceleration scaling` to make the robot move faster.

# Writing your own scripts and packages
1. First step is to make sure to create your workspace: https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-A-Workspace/Creating-A-Workspace.html
2. You can then follow these instructions on creating your first ROS2 packge: https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Creating-Your-First-ROS2-Package.html
3. To access your files outside of WSL (if you are using WSL/Native Windows), type `explorer.exe .` inside WSL (Note: the period is very important). 
